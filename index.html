<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 영화 추천 엔진</title>
    <style>
        :root { --netflix-red: #e50914; --dark-bg: #141414; --card-bg: #1f1f1f; }
        body { background-color: var(--dark-bg); color: white; font-family: 'Pretendard', sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 40px; }
        header h1 { color: var(--netflix-red); font-size: 2.5rem; margin-bottom: 10px; }

        /* 입력 폼 스타일 */
        .filter-section { background: var(--card-bg); padding: 25px; border-radius: 12px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .input-group { display: flex; flex-direction: column; }
        label { margin-bottom: 8px; font-size: 0.9rem; color: #aaa; }
        select, input { padding: 12px; border-radius: 6px; border: 1px solid #333; background: #2b2b2b; color: white; font-size: 1rem; }
        button { grid-column: 1 / -1; padding: 15px; background: var(--netflix-red); border: none; border-radius: 6px; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1.1rem; }
        button:hover { background: #ff0a16; transform: translateY(-2px); }

        /* 그리드 및 카드 스타일 */
        .movie-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 25px; }
        .movie-card { background: var(--card-bg); border-radius: 10px; overflow: hidden; transition: 0.3s; position: relative; border: 1px solid #333; height: 100%; }
        .movie-card:hover { transform: scale(1.05); z-index: 10; border-color: var(--netflix-red); }
        .poster { width: 100%; height: 320px; background: #222; object-fit: cover; display: block; }
        .movie-info { padding: 15px; }
        .movie-info h3 { margin: 0 0 10px 0; font-size: 1.2rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .tags { display: flex; flex-wrap: wrap; gap: 5px; }
        .tag { font-size: 0.75rem; background: #333; padding: 3px 8px; border-radius: 4px; color: #ccc; }
        .match-score { position: absolute; top: 10px; left: 10px; background: rgba(70, 211, 105, 0.9); color: black; padding: 5px 10px; border-radius: 20px; font-weight: bold; font-size: 0.85rem; z-index: 2; }
        
        /* 로딩 표시 */
        .loading { grid-column: 1/-1; text-align: center; padding: 50px; font-size: 1.2rem; color: #aaa; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>AI Netflix 영화 추천</h1>
        <p>AI 기반 영화 추천</p>
    </header>

    <div class="filter-section">
        <div class="input-group">
            <label>나이</label>
            <input type="number" id="age" value="25">
        </div>
        <div class="input-group">
            <label>성별</label>
            <select id="gender">
                <option value="both">전체</option>
                <option value="male">남성</option>
                <option value="female">여성</option>
            </select>
        </div>
        <div class="input-group">
            <label>MBTI</label>
            <select id="mbti">
                <option value="INTJ">INTJ</option><option value="ENTP">ENTP</option>
                <option value="INFJ">INFJ</option><option value="ENFP">ENFP</option>
                <option value="INTP">INTP</option><option value="ISTP">ISTP</option>
                <option value="ENTJ">ENTJ</option><option value="ISFP">ISFP</option>
            </select>
        </div>
        <button onclick="recommend()">분석 및 영화 추천 시작</button>
    </div>

    <div id="movieGrid" class="movie-grid"></div>
</div>

<script>
    // 1. TMDB 설정 (제공해주신 API 키 적용)
const ACCESS_TOKEN = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyZTE5OWU4MmU4ODYzOWZkNTMzZTMyNmZmYjg0MTdjMiIsIm5iZiI6MTc2NzI5NTA3My4yNTksInN1YiI6IjY5NTZjODYxOTJlMTMzYWYxNjc0ZjhlZSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.fJ_atZsM55JMczryf3C1XyXVKS_NHp2sUBMtNcBTEgo';
    const IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/w500';

    // 2. 영화 데이터 (샘플 리스트 완성)
    const movies = [
        {"id": 1, "title": "전지적 독자 시점", "age": [15, 35], "gender": "both", "mbti": ["INTJ", "ENTP", "INFJ", "ENFP", "INTP"], "genres": ["판타지", "액션"]},
    {"id": 2, "title": "대부", "age": [30, 60], "gender": "male", "mbti": ["INTJ", "ENTJ", "ISTJ", "ESTJ"], "genres": ["범죄", "드라마"]},
    {"id": 3, "title": "기생충", "age": [20, 50], "gender": "both", "mbti": ["INTJ", "INTP", "INFJ", "ENTP"], "genres": ["드라마", "스릴러"]},
    {"id": 4, "title": "슈렉", "age": [5, 40], "gender": "both", "mbti": ["ENFP", "ESFP", "ISFP"], "genres": ["애니메이션", "코미디"]},
    {"id": 5, "title": "위플래쉬", "age": [15, 40], "gender": "both", "mbti": ["INTJ", "ENTJ", "ISTP"], "genres": ["음악", "드라마"]},
    {"id": 6, "title": "나이브스 아웃", "age": [15, 50], "gender": "both", "mbti": ["INTP", "ENTP", "INTJ"], "genres": ["미스터리", "추리"]},
    {"id": 7, "title": "센과 치히로의 행방불명", "age": [5, 45], "gender": "both", "mbti": ["INFJ", "INFP", "ISFP"], "genres": ["애니메이션", "판타지"]},
    {"id": 8, "title": "포레스트 검프", "age": [10, 65], "gender": "both", "mbti": ["ISFJ", "INFP", "ESFJ", "INFJ"], "genres": ["드라마", "휴먼"]},
    {"id": 9, "title": "셔터 아일랜드", "age": [20, 50], "gender": "both", "mbti": ["INTJ", "INTP", "INFJ", "ISTP"], "genres": ["스릴러", "미스터리"]},
    {"id": 10, "title": "아가씨", "age": [20, 40], "gender": "female", "mbti": ["INFJ", "INTJ", "ISFP", "ENTP"], "genres": ["로맨스", "드라마"]},
{"id": 11, "title": "대홍수", "age": [15, 50], "gender": "both", "mbti": ["ISTP", "INTJ", "ENTP", "ESTP", "INTP"], "genres": ["SF", "재난", "스릴러"]},
    {"id": 12, "title": "야당", "age": [20, 55], "gender": "male", "mbti": ["ENTJ", "INTJ", "ISTJ", "ENTP", "ENFJ"], "genres": ["범죄", "드라마", "정치"]},
    {"id": 13, "title": "나이브스 아웃: 글래스 어니언", "age": [15, 50], "gender": "both", "mbti": ["INTP", "ENTP", "INTJ", "INFJ", "ISTP"], "genres": ["추리", "미스터리", "코미디"]},
    {"id": 14, "title": "그린치", "age": [5, 45], "gender": "both", "mbti": ["ENFP", "ESFP", "ISFP", "INFP", "ENTP"], "genres": ["애니메이션", "가족", "코미디"]},
    {"id": 15, "title": "28년 후", "age": [19, 45], "gender": "male", "mbti": ["ISTP", "ESTP", "INTJ", "INTP", "ENTP"], "genres": ["공포", "스릴러", "SF"]},
    {"id": 16, "title": "이티(E.T.)", "age": [5, 60], "gender": "both", "mbti": ["INFP", "ENFP", "INFJ", "ISFJ", "ISFP"], "genres": ["SF", "모험", "가족"]},
    {"id": 17, "title": "펄프 픽션", "age": [19, 45], "gender": "male", "mbti": ["ENTP", "ISTP", "ESTP", "INTP", "INTJ"], "genres": ["범죄", "스릴러", "느와르"]},
    {"id": 18, "title": "죠스", "age": [15, 60], "gender": "both", "mbti": ["ISTP", "ESTP", "ISTJ", "INTJ", "ENTP"], "genres": ["공포", "스릴러", "모험"]},
    {"id": 19, "title": "베놈: 라스트 댄스", "age": [15, 40], "gender": "male", "mbti": ["ESTP", "ISTP", "ENTP", "ENFP", "ESFP"], "genres": ["액션", "SF", "안티히어로"]},
    {"id": 20, "title": "어메이징 스파이더맨", "age": [12, 35], "gender": "both", "mbti": ["ENFP", "INFP", "ISFP", "ENTP", "INFJ"], "genres": ["액션", "히어로", "로맨스"]},
    {"id": 21, "title": "나우 유 씨 미 2", "age": [12, 45], "gender": "both", "mbti": ["ENTP", "ESTP", "INTJ", "ENFP", "ISTP"], "genres": ["범죄", "마술", "액션"]},
    {"id": 22, "title": "로맨틱 홀리데이", "age": [15, 45], "gender": "female", "mbti": ["ENFP", "INFP", "ENFJ", "ISFP", "ESFP"], "genres": ["로맨스", "코미디"]},
    {"id": 23, "title": "글래디에이터", "age": [15, 60], "gender": "male", "mbti": ["ENTJ", "ISTJ", "INTJ", "ESTJ", "INFJ"], "genres": ["액션", "사극", "드라마"]},
    {"id": 24, "title": "클라우스", "age": [5, 50], "gender": "both", "mbti": ["INFP", "INFJ", "ENFP", "ISFJ", "ISFP"], "genres": ["애니메이션", "가족", "감동"]},
    {"id": 25, "title": "더 이퀄라이저", "age": [19, 50], "gender": "male", "mbti": ["ISTJ", "INTJ", "ISTP", "ISTJ", "INFJ"], "genres": ["액션", "범죄", "스릴러"]},
    {"id": 26, "title": "하울의 움직이는 성", "age": [5, 45], "gender": "both", "mbti": ["INFP", "INFJ", "ENFP", "ISFP", "ENFJ"], "genres": ["애니메이션", "판타지", "로맨스"]},
    {"id": 27, "title": "캐치 미 이프 유 캔", "age": [12, 55], "gender": "both", "mbti": ["ENTP", "ESTP", "ENFP", "INTJ", "INTP"], "genres": ["범죄", "실화", "드라마"]},
    {"id": 28, "title": "마다가스카", "age": [5, 40], "gender": "both", "mbti": ["ESFP", "ENFP", "ESTP", "ENTP", "ESFJ"], "genres": ["애니메이션", "코미디", "모험"]},
    {"id": 29, "title": "퓨리오사: 매드맥스 사가", "age": [15, 45], "gender": "both", "mbti": ["ISTP", "INTJ", "ESTP", "ENTJ", "ISTJ"], "genres": ["액션", "SF", "포스트아포칼립스"]},
    {"id": 30, "title": "쥬라기 월드", "age": [12, 50], "gender": "both", "mbti": ["ESTP", "ISTP", "ENTP", "INTJ", "ENFP"], "genres": ["액션", "모험", "SF"]},
    {"id": 31, "title": "굿 윌 헌팅", "age": [15, 50], "gender": "both", "mbti": ["INTP", "INFJ", "INFP", "INTJ", "ENFJ"], "genres": ["드라마", "휴먼", "성장"]},
    {"id": 32, "title": "라이언 일병 구하기", "age": [15, 65], "gender": "male", "mbti": ["ISTJ", "ESTJ", "INFJ", "INTJ", "ISFJ"], "genres": ["전쟁", "액션", "드라마"]},
    {"id": 33, "title": "슈퍼배드", "age": [5, 40], "gender": "both", "mbti": ["ENTP", "ENFP", "ESFP", "INTJ", "ESTP"], "genres": ["애니메이션", "코미디", "가족"]},
    {"id": 34, "title": "탑건: 매버릭", "age": [12, 60], "gender": "both", "mbti": ["ESTP", "ISTP", "ENTJ", "ESTJ", "ENFJ"], "genres": ["액션", "드라마"]},
    {"id": 35, "title": "올드보이", "age": [19, 50], "gender": "both", "mbti": ["INTJ", "INFJ", "INTP", "ISTP", "ENTP"], "genres": ["스릴러", "복수", "미스터리"]},
    {"id": 36, "title": "컨택트(Arrival)", "age": [12, 50], "gender": "both", "mbti": ["INTJ", "INTP", "INFJ", "INFP", "ENTJ"], "genres": ["SF", "미스터리", "철학"]},
    {"id": 37, "title": "그린 북", "age": [12, 60], "gender": "both", "mbti": ["ISFJ", "ESFJ", "INFJ", "ENFJ", "ISFP"], "genres": ["드라마", "실화", "휴먼"]},
    {"id": 38, "title": "분노의 질주", "age": [15, 45], "gender": "male", "mbti": ["ESTP", "ISTP", "ESFP", "ESTJ", "ENTP"], "genres": ["액션", "범죄", "카체이싱"]},
    {"id": 39, "title": "킬 빌", "age": [19, 45], "gender": "both", "mbti": ["ISTP", "INTJ", "ENTP", "ESTP", "ENTJ"], "genres": ["액션", "복수", "예술"]},
    {"id": 40, "title": "레버넌트", "age": [15, 55], "gender": "male", "mbti": ["ISTP", "ISTJ", "INTJ", "INFJ", "ISFP"], "genres": ["모험", "드라마", "실화"]},
    {"id": 41, "title": "에브리씽 에브리웨어 올 앳 원스", "age": [15, 45], "gender": "both", "mbti": ["ENFP", "ENTP", "INFP", "INFJ", "INTP"], "genres": ["SF", "액션", "가족"]},
    {"id": 42, "title": "죽은 시인의 사회", "age": [12, 55], "gender": "both", "mbti": ["INFP", "INFJ", "ENFP", "ENFJ", "ISFP"], "genres": ["드라마", "교육", "감동"]},
    {"id": 43, "title": "이웃집 토토로", "age": [5, 60], "gender": "both", "mbti": ["INFP", "ISFP", "ISFJ", "ENFP", "INFJ"], "genres": ["애니메이션", "판타지", "힐링"]},
    {"id": 44, "title": "설국열차", "age": [15, 50], "gender": "both", "mbti": ["INTJ", "ENTJ", "INFJ", "INTP", "ISTP"], "genres": ["SF", "액션", "사회"]},
    {"id": 45, "title": "모노노케 히메", "age": [12, 50], "gender": "both", "mbti": ["INFJ", "INTJ", "INFP", "ISTP", "ENTJ"], "genres": ["애니메이션", "판타지", "철학"]},
{"id": 46, "title": "프랑켄슈타인", "age": [15, 55], "gender": "both", "mbti": ["INTP", "INTJ", "INFJ", "ISTP", "ENFJ"], "genres": ["SF", "공포", "고전"]},
    {"id": 47, "title": "용자들의 시간", "age": [15, 45], "gender": "male", "mbti": ["ESTP", "ISTP", "ENTJ", "ESTJ", "ENTP"], "genres": ["액션", "전쟁"]},
    {"id": 48, "title": "6시간 후 너는 죽는다", "age": [15, 40], "gender": "both", "mbti": ["INTJ", "INTP", "INFJ", "ISTP", "ENTP"], "genres": ["스릴러", "미스터리"]},
    {"id": 49, "title": "슈렉 포에버", "age": [5, 45], "gender": "both", "mbti": ["ENFP", "ESFP", "ENTP", "ESFJ", "ISFP"], "genres": ["애니메이션", "코미디", "가족"]},
    {"id": 50, "title": "브링 허 백", "age": [19, 45], "gender": "female", "mbti": ["INFJ", "INTJ", "ISFP", "INFP", "ISTP"], "genres": ["스릴러", "범죄", "드라마"]},
    {"id": 51, "title": "거룩한 밤: 데몬 헌터스", "age": [15, 45], "gender": "both", "mbti": ["ISTP", "ESTP", "ENTP", "INTJ", "ESFP"], "genres": ["액션", "오컬트", "판타지"]},
    {"id": 52, "title": "더 길티", "age": [15, 50], "gender": "both", "mbti": ["INTJ", "ISTJ", "INTP", "INFJ", "ISTP"], "genres": ["스릴러", "범죄", "심리"]},
    {"id": 53, "title": "365일: 오늘", "age": [19, 40], "gender": "female", "mbti": ["ESFP", "ISFP", "ENFP", "ESTP", "ENFJ"], "genres": ["로맨스", "드라마"]},
    {"id": 54, "title": "대부 2", "age": [30, 65], "gender": "male", "mbti": ["INTJ", "ENTJ", "ISTJ", "ESTJ", "INFJ"], "genres": ["범죄", "드라마", "느와르"]},
    {"id": 55, "title": "크레이븐 더 헌터", "age": [15, 40], "gender": "male", "mbti": ["ISTP", "ESTP", "INTJ", "ENTP", "ENTJ"], "genres": ["액션", "히어로", "SF"]},
    {"id": 56, "title": "100 미터", "age": [12, 55], "gender": "both", "mbti": ["INFJ", "ISFJ", "ENFJ", "INFP", "ENFP"], "genres": ["드라마", "실화", "감동"]},
    {"id": 57, "title": "크리스마스 연대기", "age": [5, 50], "gender": "both", "mbti": ["ENFP", "ESFP", "ISFJ", "ESFJ", "ENTP"], "genres": ["가족", "판타지", "코미디"]},
    {"id": 58, "title": "레드 노티스", "age": [12, 50], "gender": "both", "mbti": ["ENTP", "ESTP", "ENFP", "ESFP", "INTJ"], "genres": ["액션", "코미디", "범죄"]},
    {"id": 59, "title": "슈렉 2", "age": [5, 45], "gender": "both", "mbti": ["ENFP", "ESFP", "ENTP", "ISFP", "ESFJ"], "genres": ["애니메이션", "코미디"]},
    {"id": 60, "title": "그레이의 50가지 그림자", "age": [19, 45], "gender": "female", "mbti": ["ISFP", "INFJ", "INTJ", "ESFP", "INFP"], "genres": ["로맨스", "드라마"]},
    {"id": 61, "title": "터미네이터 제니시스", "age": [15, 50], "gender": "both", "mbti": ["ISTP", "INTJ", "ESTP", "ENTJ", "INTP"], "genres": ["SF", "액션"]},
    {"id": 62, "title": "히트맨", "age": [15, 45], "gender": "both", "mbti": ["ESTP", "ENTP", "ISTP", "ESFP", "INTJ"], "genres": ["액션", "코미디"]},
    {"id": 63, "title": "히트(Heat)", "age": [19, 60], "gender": "male", "mbti": ["INTJ", "ISTJ", "ISTP", "ENTJ", "INTP"], "genres": ["범죄", "액션", "느와르"]},
    {"id": 64, "title": "하우스 오브 구찌", "age": [15, 55], "gender": "female", "mbti": ["ENTJ", "INTJ", "INFJ", "ESTJ", "ENFJ"], "genres": ["범죄", "드라마", "실화"]},
    {"id": 65, "title": "슈렉 3", "age": [5, 45], "gender": "both", "mbti": ["ENFP", "ESFP", "ENTP", "ISFP", "ESFJ"], "genres": ["애니메이션", "코미디"]},
    {"id": 66, "title": "벼랑 끝에 서서", "age": [15, 45], "gender": "both", "mbti": ["ISTP", "ESTP", "INTJ", "ENTP", "ISTJ"], "genres": ["액션", "범죄", "스릴러"]},
    {"id": 67, "title": "그을린 사랑", "age": [19, 50], "gender": "both", "mbti": ["INFJ", "INTJ", "INFP", "INTP", "ENFJ"], "genres": ["드라마", "미스터리", "전쟁"]},
    {"id": 68, "title": "원스 어폰 어 타임 인 할리우드", "age": [19, 55], "gender": "both", "mbti": ["INFP", "ISFP", "ENTP", "ENFP", "INFJ"], "genres": ["드라마", "코미디"]},
    {"id": 69, "title": "댐즐", "age": [12, 40], "gender": "female", "mbti": ["INFJ", "ISFP", "INTJ", "ENFP", "INFP"], "genres": ["판타지", "액션", "모험"]},
    {"id": 70, "title": "RRR", "age": [15, 50], "gender": "both", "mbti": ["ENFJ", "ENTJ", "ESFP", "ESTP", "ENFP"], "genres": ["액션", "뮤지컬", "드라마"]},
    {"id": 71, "title": "쥬라기 월드: 폴른 킹덤", "age": [12, 50], "gender": "both", "mbti": ["ESTP", "ISTP", "ENTP", "INTJ", "ENFP"], "genres": ["액션", "모험", "SF"]},
    {"id": 72, "title": "극장판 귀멸의 칼날: 무한열차편", "age": [12, 40], "gender": "both", "mbti": ["ENFJ", "ESFJ", "INFJ", "ISFP", "ISFJ"], "genres": ["애니메이션", "액션", "판타지"]},
    {"id": 73, "title": "킬 빌: 2부", "age": [19, 45], "gender": "both", "mbti": ["ISTP", "INTJ", "ENTP", "ESTP", "INTP"], "genres": ["액션", "복수"]},
    {"id": 74, "title": "라스트 크리스마스", "age": [12, 45], "gender": "female", "mbti": ["ENFP", "INFP", "INFJ", "ISFP", "ESFJ"], "genres": ["로맨스", "코미디", "판타지"]},
    {"id": 75, "title": "나의 히어로 아카데미아 더 무비", "age": [12, 35], "gender": "both", "mbti": ["ENFP", "ENFJ", "ESFJ", "INFJ", "ISFP"], "genres": ["애니메이션", "액션", "히어로"]},
    {"id": 76, "title": "로리타", "age": [19, 55], "gender": "both", "mbti": ["INFJ", "INTJ", "INFP", "INTP", "ISFP"], "genres": ["드라마", "로맨스"]},
    {"id": 77, "title": "익스펜더블 4", "age": [19, 50], "gender": "male", "mbti": ["ESTP", "ISTP", "ESTJ", "ENTJ", "ESFP"], "genres": ["액션", "범죄"]},
    {"id": 78, "title": "해벅", "age": [19, 45], "gender": "male", "mbti": ["ISTP", "ESTP", "INTJ", "ENTJ", "ISTJ"], "genres": ["액션", "범죄", "스릴러"]},
    {"id": 79, "title": "서부 전선 이상 없다", "age": [15, 60], "gender": "male", "mbti": ["INFJ", "INTJ", "ISTJ", "INFP", "ISFJ"], "genres": ["전쟁", "드라마"]},
    {"id": 80, "title": "기묘한 이야기", "age": [15, 40], "gender": "both", "mbti": ["ENFP", "INFP", "ENTP", "INFJ", "INTP"], "genres": ["SF", "판타지", "공포"]},
    {"id": 81, "title": "노이즈", "age": [15, 45], "gender": "both", "mbti": ["INTJ", "INTP", "ISTP", "INFJ", "ENTP"], "genres": ["스릴러", "공포"]},
    {"id": 82, "title": "솔드 아웃", "age": [5, 50], "gender": "both", "mbti": ["ESFJ", "ISFJ", "ENFP", "ESFP", "ENTP"], "genres": ["코미디", "가족"]},
{"id": 83, "title": "트롤의 습격 2", "age": [12, 45], "gender": "both", "mbti": ["ESTP", "ENFP", "ESFP", "ENTP", "ISTP"], "genres": ["애니메이션", "모험", "판타지"]},
    {"id": 84, "title": "케이팝 데몬 헌터", "age": [15, 35], "gender": "both", "mbti": ["ENFP", "ESFP", "ENTP", "ENFJ", "ISFP"], "genres": ["액션", "음악", "판타지"]},
    {"id": 85, "title": "노이즈", "age": [15, 45], "gender": "both", "mbti": ["INTJ", "INTP", "ISTP", "INFJ", "ENTP"], "genres": ["스릴러", "공포"]},
    {"id": 86, "title": "굿바이, 준", "age": [15, 45], "gender": "both", "mbti": ["INFJ", "INFP", "ISFP", "ISFJ", "ENFJ"], "genres": ["드라마", "휴먼"]},
    {"id": 87, "title": "밤은 혼자다: 반", "age": [19, 50], "gender": "both", "mbti": ["INTJ", "INFJ", "ISTP", "ISTJ", "ENTJ"], "genres": ["미스터리", "스릴러"]},
    {"id": 88, "title": "기차의 꿈", "age": [12, 60], "gender": "both", "mbti": ["INFP", "ISFJ", "INFJ", "ENFP", "ISFP"], "genres": ["판타지", "드라마", "가족"]},
    {"id": 89, "title": "살인자 리포트", "age": [19, 50], "gender": "male", "mbti": ["ISTP", "ISTJ", "INTJ", "INTP", "ESTP"], "genres": ["범죄", "다큐멘터리"]},
    {"id": 90, "title": "텐댄스", "age": [15, 40], "gender": "both", "mbti": ["ESFP", "ENFP", "ISFP", "ESTP", "ESFJ"], "genres": ["스포츠", "로맨스"]},
    {"id": 91, "title": "스티븐", "age": [15, 50], "gender": "both", "mbti": ["INFJ", "INFP", "ISFJ", "INTJ", "ENFJ"], "genres": ["드라마", "전기"]},
    {"id": 92, "title": "사마귀", "age": [19, 55], "gender": "both", "mbti": ["INTJ", "ISTP", "ISTJ", "ENTP", "INTP"], "genres": ["스릴러", "범죄"]},
    {"id": 93, "title": "리키 저베이스: 슈퍼네이처", "age": [19, 60], "gender": "both", "mbti": ["ENTP", "ESTP", "INTP", "ENTJ", "ISTP"], "genres": ["코미디", "스탠드업"]},
    {"id": 94, "title": "제이 켈리", "age": [15, 45], "gender": "both", "mbti": ["ENFP", "INFP", "ISFP", "INFJ", "ENFJ"], "genres": ["로맨스", "드라마"]},
    {"id": 95, "title": "커버업: 은폐된 진실", "age": [19, 55], "gender": "both", "mbti": ["INTJ", "ENTJ", "ISTJ", "INTP", "ISTP"], "genres": ["다큐멘터리", "범죄"]},
    {"id": 96, "title": "마이 시크릿 산타", "age": [12, 45], "gender": "female", "mbti": ["ENFP", "ISFP", "ESFJ", "INFP", "ESFP"], "genres": ["로맨스", "코미디"]},
    {"id": 97, "title": "악마가 이사왔다", "age": [15, 45], "gender": "both", "mbti": ["INTJ", "INFJ", "ISTP", "ISTJ", "INTP"], "genres": ["공포", "미스터리"]},
    {"id": 98, "title": "머티리얼리스트", "age": [20, 45], "gender": "both", "mbti": ["ENTJ", "ESTP", "INTJ", "ENTP", "ESTJ"], "genres": ["로맨스", "코미디"]},
    {"id": 99, "title": "6시간 후 너는 죽는다", "age": [15, 40], "gender": "both", "mbti": ["INTJ", "INTP", "INFJ", "ISTP", "ENTP"], "genres": ["스릴러", "미스터리"]}
    ];

    // 3. TMDB API에서 포스터 가져오는 함수
    async function getPosterPath(title) {
        // v4 방식은 URL에 키를 넣지 않습니다.
        const url = `https://api.themoviedb.org/3/search/movie?query=${encodeURIComponent(title)}&language=ko-KR`;
        // 헤더 옵션 설정
        const options = {
            method: 'GET',
            headers: {
                accept: 'application/json',
                Authorization: `Bearer ${ACCESS_TOKEN}` // Bearer 뒤에 한 칸 띄우는 것이 규칙입니다.
            }
        };
        try {
            const response = await fetch(url, options); // 옵션을 함께 전달합니다.
            const data = await response.json();
            if (data.results && data.results.length > 0 && data.results[0].poster_path) {
                return IMAGE_BASE_URL + data.results[0].poster_path;
            }
            return 'https://via.placeholder.com/300x450/222/fff?text=No+Image';
        } catch (error) {
            console.error("TMDB 데이터 로드 오류:", error);
            return 'https://via.placeholder.com/300x450/222/fff?text=Error';
        }
    }

    // 4. 분석 및 추천 실행 함수
    async function recommend() {
        const grid = document.getElementById('movieGrid');
        grid.innerHTML = '<div class="loading">AI가 실시간 포스터와 데이터를 분석 중입니다...</div>';

        const userAge = parseInt(document.getElementById('age').value) || 25;
        const userGender = document.getElementById('gender').value;
        const userMBTI = document.getElementById('mbti').value;

        // 적합도 점수 계산
       const scoredMovies = movies.map(movie => {
            let score = 0;

// 1. MBTI 매칭 (50점)
            if (movie.mbti.includes(userMBTI)) score += 50;

            // 2. 나이 점수 고도화 로직 (30점 만점)
            const [minAge, maxAge] = movie.age;
            const centerAge = (minAge + maxAge) / 2; // 타겟 중앙값
            const radius = (maxAge - minAge) / 2 || 1; // 연령대 절반 폭 (0 방지용 최소값 1)

            if (userAge >= minAge && userAge <= maxAge) {
                const distance = Math.abs(userAge - centerAge);
                // 중앙값에서 멀어질수록 감점 (중앙=30점, 양 끝단=10점)
                const ageScore = 30 - (distance / radius) * 20; 
                score += ageScore;
            }
            // 3. 성별 매칭 (20점)
            if (movie.gender === "both" || movie.gender === userGender) score += 20;
            return { ...movie, finalScore: Math.round(score) };
        });
        // 점수 순 정렬
        scoredMovies.sort((a, b) => b.finalScore - a.finalScore);
        // 결과 그리기
        await render(scoredMovies);
    }

    // 5. 화면에 카드 렌더링
    async function render(list) {
        const grid = document.getElementById('movieGrid');
        grid.innerHTML = '';
        const movieCards = await Promise.all(list.map(async (movie) => {
            const posterUrl = await getPosterPath(movie.title);
            return `
                <div class="movie-card">
                    <div class="match-score">${movie.finalScore}% Match</div>
                    <img class="poster" src="${posterUrl}" alt="${movie.title}" loading="lazy">
                    <div class="movie-info">
                        <h3>${movie.title}</h3>
                        <div class="tags">
                            ${movie.genres.map(g => `<span class="tag">${g}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        }));
        grid.innerHTML = movieCards.join('');
    }

    // 초기 실행
    recommend();

</script>
</body>
</html>