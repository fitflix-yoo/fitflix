<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitflix | AI 영화 추천 엔진</title>
    <style>
        :root { --netflix-red: #e50914; --dark-bg: #141414; --card-bg: #1f1f1f; }
        body { background-color: var(--dark-bg); color: white; font-family: 'Pretendard', sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 40px; }
        header h1 { color: var(--netflix-red); font-size: 2.5rem; margin-bottom: 10px; }

        /* 입력 폼 스타일 */
        .filter-section { background: var(--card-bg); padding: 25px; border-radius: 12px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .input-group { display: flex; flex-direction: column; }
        label { margin-bottom: 8px; font-size: 0.9rem; color: #aaa; }
        select, input { padding: 12px; border-radius: 6px; border: 1px solid #333; background: #2b2b2b; color: white; font-size: 1rem; }
        button { grid-column: 1 / -1; padding: 15px; background: var(--netflix-red); border: none; border-radius: 6px; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1.1rem; }
        button:hover { background: #ff0a16; transform: translateY(-2px); }

        /* 그리드 및 카드 스타일 */
        .movie-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 25px; }
        .movie-card { background: var(--card-bg); border-radius: 10px; overflow: hidden; transition: 0.3s; position: relative; border: 1px solid #333; height: 100%; }
        .movie-card:hover { transform: scale(1.05); z-index: 10; border-color: var(--netflix-red); }
        .poster { width: 100%; height: 320px; background: #222; object-fit: cover; display: block; }
        .movie-info { padding: 15px; }
        .movie-info h3 { margin: 0 0 10px 0; font-size: 1.2rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .tags { display: flex; flex-wrap: wrap; gap: 5px; }
        .tag { font-size: 0.75rem; background: #333; padding: 3px 8px; border-radius: 4px; color: #ccc; }
        .match-score { position: absolute; top: 10px; left: 10px; background: rgba(70, 211, 105, 0.9); color: black; padding: 5px 10px; border-radius: 20px; font-weight: bold; font-size: 0.85rem; z-index: 2; }
        
        .loading { grid-column: 1/-1; text-align: center; padding: 50px; font-size: 1.2rem; color: #aaa; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Fitflix</h1>
        <p>AI 기반 영화 추천 시스템</p>
    </header>

    <div class="filter-section">
        <div class="input-group">
            <label>나이</label>
            <input type="number" id="age" value="25">
        </div>
        <div class="input-group">
            <label>성별</label>
            <select id="gender">
                <option value="both">전체</option>
                <option value="male">남성</option>
                <option value="female">여성</option>
            </select>
        </div>
        <div class="input-group">
            <label>MBTI</label>
            <select id="mbti">
                <optgroup label="Analysts">
                    <option value="INTJ">INTJ</option>
                    <option value="INTP">INTP</option>
                    <option value="ENTJ">ENTJ</option>
                    <option value="ENTP">ENTP</option>
                </optgroup>
                <optgroup label="Diplomats">
                    <option value="INFJ">INFJ</option>
                    <option value="INFP">INFP</option>
                    <option value="ENFJ">ENFJ</option>
                    <option value="ENFP">ENFP</option>
                </optgroup>
                <optgroup label="Sentinels">
                    <option value="ISTJ">ISTJ</option>
                    <option value="ISFJ">ISFJ</option>
                    <option value="ESTJ">ESTJ</option>
                    <option value="ESFJ">ESFJ</option>
                </optgroup>
                <optgroup label="Explorers">
                    <option value="ISTP">ISTP</option>
                    <option value="ISFP">ISFP</option>
                    <option value="ESTP">ESTP</option>
                    <option value="ESFP">ESFP</option>
                </optgroup>
            </select>
        </div>
        <button onclick="recommend()">분석 및 영화 추천 시작</button>
    </div>

    <div id="movieGrid" class="movie-grid"></div>
</div>

<script>
    // 1. TMDB 설정
    const ACCESS_TOKEN = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyZTE5OWU4MmU4ODYzOWZkNTMzZTMyNmZmYjg0MTdjMiIsIm5iZiI6MTc2NzI5NTA3My4yNTksInN1YiI6IjY5NTZjODYxOTJlMTMzYWYxNjc0ZjhlZSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.fJ_atZsM55JMczryf3C1XyXVKS_NHp2sUBMtNcBTEgo';
    const IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/w500';

    // 2. 영화 데이터 (99개 전체 리스트)
const movies = [
    {"id": 1, "title": "전지적 독자 시점", "age": [15, 35], "gender": "both", "mbti": "INTJ", "genres": ["판타지", "액션"]},
    {"id": 2, "title": "대부", "age": [30, 60], "gender": "male", "mbti": "ISTJ", "genres": ["범죄", "드라마"]},
    {"id": 3, "title": "기생충", "age": [20, 50], "gender": "both", "mbti": "INTJ", "genres": ["드라마", "스릴러"]},
    {"id": 4, "title": "슈렉", "age": [5, 40], "gender": "both", "mbti": "ENFP", "genres": ["애니메이션", "코미디"]},
    {"id": 5, "title": "위플래쉬", "age": [15, 40], "gender": "both", "mbti": "ENTJ", "genres": ["음악", "드라마"]},
    {"id": 6, "title": "나이브스 아웃", "age": [15, 50], "gender": "both", "mbti": "INTP", "genres": ["미스터리", "추리"]},
    {"id": 7, "title": "센과 치히로의 행방불명", "age": [5, 45], "gender": "both", "mbti": "INFJ", "genres": ["애니메이션", "판타지"]},
    {"id": 8, "title": "포레스트 검프", "age": [10, 65], "gender": "both", "mbti": "ISFJ", "genres": ["드라마", "휴먼"]},
    {"id": 9, "title": "셔터 아일랜드", "age": [20, 50], "gender": "both", "mbti": "INTP", "genres": ["스릴러", "미스터리"]},
    {"id": 10, "title": "아가씨", "age": [20, 40], "gender": "both", "mbti": "INTJ", "genres": ["로맨스", "드라마"]},
    {"id": 11, "title": "대홍수", "age": [15, 50], "gender": "both", "mbti": "ISTP", "genres": ["SF", "재난"]},
    {"id": 12, "title": "야당", "age": [20, 55], "gender": "male", "mbti": "ENTJ", "genres": ["범죄", "정치"]},
    {"id": 13, "title": "글래스 어니언", "age": [15, 50], "gender": "both", "mbti": "ENTP", "genres": ["추리", "코미디"]},
    {"id": 14, "title": "그린치", "age": [5, 45], "gender": "both", "mbti": "ESTP", "genres": ["애니메이션", "코미디"]},
    {"id": 15, "title": "28년 후", "age": [19, 45], "gender": "male", "mbti": "ISTP", "genres": ["공포", "SF"]},
    {"id": 16, "title": "이티", "age": [5, 60], "gender": "both", "mbti": "INFP", "genres": ["SF", "가족"]},
    {"id": 17, "title": "펄프 픽션", "age": [19, 45], "gender": "male", "mbti": "ENTP", "genres": ["범죄", "느와르"]},
    {"id": 18, "title": "죠스", "age": [15, 60], "gender": "both", "mbti": "ISTJ", "genres": ["공포", "스릴러"]},
    {"id": 19, "title": "베놈: 라스트 댄스", "age": [15, 40], "gender": "male", "mbti": "ESTP", "genres": ["액션", "SF"]},
    {"id": 20, "title": "어메이징 스파이더맨", "age": [12, 35], "gender": "both", "mbti": "ENFP", "genres": ["히어로", "로맨스"]},
    {"id": 21, "title": "나우 유 씨 미 2", "age": [12, 45], "gender": "both", "mbti": "ENTP", "genres": ["범죄", "마술"]},
    {"id": 22, "title": "로맨틱 홀리데이", "age": [15, 45], "gender": "female", "mbti": ["ENFP", "INFP", "ENFJ", "ISFP", "ESFP"], "genres": ["로맨스", "코미디"]},
    {"id": 23, "title": "글래디에이터", "age": [15, 60], "gender": "male", "mbti": "ENTJ", "genres": ["액션", "드라마"]},
    {"id": 24, "title": "클라우스", "age": [5, 50], "gender": "both", "mbti": "INFJ", "genres": ["애니메이션", "가족"]},
    {"id": 25, "title": "더 이퀄라이저", "age": [19, 50], "gender": "male", "mbti": "ISTJ", "genres": ["액션", "범죄"]},
    {"id": 26, "title": "하울의 움직이는 성", "age": [5, 45], "gender": "both", "mbti": "INFP", "genres": ["애니메이션", "판타지"]},
    {"id": 27, "title": "캐치 미 이프 유 캔", "age": [12, 55], "gender": "both", "mbti": "ENTP", "genres": ["범죄", "실화"]},
    {"id": 28, "title": "마다가스카", "age": [5, 40], "gender": "both", "mbti": "ESFP", "genres": ["애니메이션", "코미디"]},
    {"id": 29, "title": "퓨리오사: 매드맥스 사가", "age": [15, 45], "gender": "both", "mbti": "ISTP", "genres": ["액션", "SF"]},
    {"id": 30, "title": "쥬라기 월드", "age": [12, 50], "gender": "both", "mbti": "ESTP", "genres": ["액션", "모험"]},
    {"id": 31, "title": "굿 윌 헌팅", "age": [15, 50], "gender": "both", "mbti": "INTP", "genres": ["드라마", "휴먼"]},
    {"id": 32, "title": "라이언 일병 구하기", "age": [15, 65], "gender": "male", "mbti": "ISTJ", "genres": ["전쟁", "드라마"]},
    {"id": 33, "title": "슈퍼배드", "age": [5, 40], "gender": "both", "mbti": "ENTP", "genres": ["애니메이션", "코미디"]},
    {"id": 34, "title": "탑건: 매버릭", "age": [12, 60], "gender": "both", "mbti": "ESTP", "genres": ["액션", "드라마"]},
    {"id": 35, "title": "올드보이", "age": [19, 50], "gender": "both", "mbti": "INTJ", "genres": ["스릴러", "복수"]},
    {"id": 36, "title": "컨택트", "age": [12, 50], "gender": "both", "mbti": "INFJ", "genres": ["SF", "미스터리"]},
    {"id": 37, "title": "그린 북", "age": [12, 60], "gender": "both", "mbti": "ISFJ", "genres": ["드라마", "휴먼"]},
    {"id": 38, "title": "분노의 질주", "age": [15, 45], "gender": "male", "mbti": "ESTP", "genres": ["액션", "카체이싱"]},
    {"id": 39, "title": "킬 빌", "age": [19, 45], "gender": "both", "mbti": "ISTP", "genres": ["액션", "복수"]},
    {"id": 40, "title": "레버넌트", "age": [15, 55], "gender": "male", "mbti": "ISTP", "genres": ["모험", "실화"]},
    {"id": 41, "title": "에브리씽 에브리웨어 올 앳 원스", "age": [15, 45], "gender": "both", "mbti": "ENFP", "genres": ["SF", "가족"]},
    {"id": 42, "title": "죽은 시인의 사회", "age": [12, 55], "gender": "both", "mbti": "INFJ", "genres": ["드라마", "교육"]},
    {"id": 43, "title": "이웃집 토토로", "age": [5, 60], "gender": "both", "mbti": "INFP", "genres": ["애니메이션", "힐링"]},
    {"id": 44, "title": "설국열차", "age": [15, 50], "gender": "both", "mbti": "INTJ", "genres": ["SF", "사회"]},
    {"id": 45, "title": "모노노케 히메", "age": [12, 50], "gender": "both", "mbti": "INFJ", "genres": ["애니메이션", "철학"]},
    {"id": 46, "title": "프랑켄슈타인", "age": [15, 55], "gender": "both", "mbti": "INTP", "genres": ["SF", "공포"]},
    {"id": 54, "title": "대부 2", "age": [30, 65], "gender": "male", "mbti": "INTJ", "genres": ["범죄", "느와르"]},
    {"id": 56, "title": "100 미터.", "age": [12, 55], "gender": "both", "mbti": "ENFJ", "genres": ["드라마", "감동"]},
    {"id": 63, "title": "히트", "age": [19, 60], "gender": "male", "mbti": "ISTJ", "genres": ["범죄", "느와르"]},
    {"id": 67, "title": "그을린 사랑", "age": [19, 50], "gender": "both", "mbti": "INFJ", "genres": ["드라마", "전쟁"]},
    {"id": 70, "title": "RRR", "age": [15, 50], "gender": "both", "mbti": "ENFJ", "genres": ["액션", "뮤지컬"]},
    {"id": 82, "title": "솔드 아웃", "age": [5, 50], "gender": "both", "mbti": "ESFJ", "genres": ["코미디", "가족"]},
    {"id": 89, "title": "살인자 리포트", "age": [19, 50], "gender": "male", "mbti": "ISTP", "genres": ["범죄", "다큐"]}
];

    // 3. TMDB API에서 포스터 가져오는 함수
    async function getPosterPath(title) {
        const url = `https://api.themoviedb.org/3/search/movie?query=${encodeURIComponent(title)}&language=ko-KR`;
        const options = {
            method: 'GET',
            headers: {
                accept: 'application/json',
                Authorization: `Bearer ${ACCESS_TOKEN}`
            }
        };
        try {
            const response = await fetch(url, options);
            const data = await response.json();
            if (data.results && data.results.length > 0 && data.results[0].poster_path) {
                return IMAGE_BASE_URL + data.results[0].poster_path;
            }
            return 'https://via.placeholder.com/300x450/222/fff?text=No+Image';
        } catch (error) {
            console.error("TMDB 오류:", error);
            return 'https://via.placeholder.com/300x450/222/fff?text=Error';
        }
    }

    // 4. MBTI 유사도 계산 함수 (독립 선언)
    function getMbtiScore(userMbti, movieMbti) {
        let matchCount = 0;
    
        // 4글자를 순차적으로 비교 (예: ENTJ vs INTJ)
        for (let i = 0; i < 4; i++) {
            if (userMbti[i] === movieMbti[i]) matchCount++;
        }
    
        // 일치하는 글자 수에 따라 0, 12.5, 25, 37.5, 50점 부여
        return (matchCount / 4) * 50;
    }

    // 5. 분석 및 추천 실행 함수
    async function recommend() {
        const grid = document.getElementById('movieGrid');
        grid.innerHTML = '<div class="loading">MBTI 유사도와 연령 가중치를 정밀 분석 중입니다...</div>';

        const userAge = parseInt(document.getElementById('age').value) || 25;
        const userGender = document.getElementById('gender').value;
        const userMBTI = document.getElementById('mbti').value;

        const scoredMovies = movies.map(movie => {
            let score = 0;

            // [MBTI 유사도 매칭] 12.5점 단위로 정교하게 점수 부여
            score += getMbtiScore(userMBTI, movie.mbti);

            // [나이 점수 중앙값 감쇄 로직]
            const [minAge, maxAge] = movie.age;
            const centerAge = (minAge + maxAge) / 2;
            const radius = (maxAge - minAge) / 2 || 1;
            if (userAge >= minAge && userAge <= maxAge) {
                const distance = Math.abs(userAge - centerAge);
                const ageScore = 30 - (distance / radius) * 20; 
                score += ageScore;
            }

            // [성별 매칭]
            if (movie.gender === "both" || movie.gender === userGender) score += 20;

            return { ...movie, finalScore: Math.round(score) };
        });

        scoredMovies.sort((a, b) => b.finalScore - a.finalScore);
        await render(scoredMovies);
    }

    // 6. 화면에 카드 렌더링
    async function render(list) {
        const grid = document.getElementById('movieGrid');
        grid.innerHTML = '';
        const movieCards = await Promise.all(list.map(async (movie) => {
            const posterUrl = await getPosterPath(movie.title);
            return `
                <div class="movie-card">
                    <div class="match-score">${movie.finalScore}% Match</div>
                    <img class="poster" src="${posterUrl}" alt="${movie.title}" loading="lazy">
                    <div class="movie-info">
                        <h3>${movie.title}</h3>
                        <div class="tags">
                            ${movie.genres.map(g => `<span class="tag">${g}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        }));
        grid.innerHTML = movieCards.join('');
    }

    // 초기 실행
    recommend();
</script>
</body>
</html>




