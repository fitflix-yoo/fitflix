<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fitflix | AI 영화 추천 엔진</title>
    <style>
        :root { --netflix-red: #e50914; --dark-bg: #141414; --card-bg: #1f1f1f; }
        body { background-color: var(--dark-bg); color: white; font-family: 'Pretendard', sans-serif; margin: 0; padding: 20px; }
        .container { max-width: 1100px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 40px; }
        header h1 { color: var(--netflix-red); font-size: 2.5rem; margin-bottom: 10px; }

        /* 입력 폼 스타일 */
        .filter-section { background: var(--card-bg); padding: 25px; border-radius: 12px; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .input-group { display: flex; flex-direction: column; }
        label { margin-bottom: 8px; font-size: 0.9rem; color: #aaa; }
        select, input { padding: 12px; border-radius: 6px; border: 1px solid #333; background: #2b2b2b; color: white; font-size: 1rem; }
        button { grid-column: 1 / -1; padding: 15px; background: var(--netflix-red); border: none; border-radius: 6px; color: white; font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1.1rem; }
        button:hover { background: #ff0a16; transform: translateY(-2px); }

        /* 그리드 및 카드 스타일 */
        .movie-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 25px; }
        .movie-card { background: var(--card-bg); border-radius: 10px; overflow: hidden; transition: 0.3s; position: relative; border: 1px solid #333; height: 100%; }
        .movie-card:hover { transform: scale(1.05); z-index: 10; border-color: var(--netflix-red); }
        .poster { width: 100%; height: 320px; background: #222; object-fit: cover; display: block; }
        .movie-info { padding: 15px; }
        .movie-info h3 { margin: 0 0 10px 0; font-size: 1.2rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .tags { display: flex; flex-wrap: wrap; gap: 5px; }
        .tag { font-size: 0.75rem; background: #333; padding: 3px 8px; border-radius: 4px; color: #ccc; }
        .match-score { position: absolute; top: 10px; left: 10px; background: rgba(70, 211, 105, 0.9); color: black; padding: 5px 10px; border-radius: 20px; font-weight: bold; font-size: 0.85rem; z-index: 2; }
        
        .loading { grid-column: 1/-1; text-align: center; padding: 50px; font-size: 1.2rem; color: #aaa; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Fitflix</h1>
        <p>AI 기반 영화 추천 시스템</p>
    </header>

    <div class="filter-section">
        <div class="input-group">
            <label>나이</label>
            <input type="number" id="age" value="25">
        </div>
        <div class="input-group">
            <label>성별</label>
            <select id="gender">
                <option value="both">전체</option>
                <option value="male">남성</option>
                <option value="female">여성</option>
            </select>
        </div>
        <div class="input-group">
            <label>MBTI</label>
            <select id="mbti">
                <optgroup label="Analysts">
                    <option value="INTJ">INTJ</option>
                    <option value="INTP">INTP</option>
                    <option value="ENTJ">ENTJ</option>
                    <option value="ENTP">ENTP</option>
                </optgroup>
                <optgroup label="Diplomats">
                    <option value="INFJ">INFJ</option>
                    <option value="INFP">INFP</option>
                    <option value="ENFJ">ENFJ</option>
                    <option value="ENFP">ENFP</option>
                </optgroup>
                <optgroup label="Sentinels">
                    <option value="ISTJ">ISTJ</option>
                    <option value="ISFJ">ISFJ</option>
                    <option value="ESTJ">ESTJ</option>
                    <option value="ESFJ">ESFJ</option>
                </optgroup>
                <optgroup label="Explorers">
                    <option value="ISTP">ISTP</option>
                    <option value="ISFP">ISFP</option>
                    <option value="ESTP">ESTP</option>
                    <option value="ESFP">ESFP</option>
                </optgroup>
            </select>
        </div>
        <button onclick="recommend()">분석 및 영화 추천 시작</button>
    </div>

    <div id="movieGrid" class="movie-grid"></div>
</div>

<script>
    // 1. TMDB 설정
    const ACCESS_TOKEN = 'eyJhbGciOiJIUzI1NiJ9.eyJhdWQiOiIyZTE5OWU4MmU4ODYzOWZkNTMzZTMyNmZmYjg0MTdjMiIsIm5iZiI6MTc2NzI5NTA3My4yNTksInN1YiI6IjY5NTZjODYxOTJlMTMzYWYxNjc0ZjhlZSIsInNjb3BlcyI6WyJhcGlfcmVhZCJdLCJ2ZXJzaW9uIjoxfQ.fJ_atZsM55JMczryf3C1XyXVKS_NHp2sUBMtNcBTEgo';
    const IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/w500';

    // 2. 영화 데이터 (100개 리스트 유지)
    const movies = [
        {"id": 1, "title": "전지적 독자 시점", "age": [15, 35], "gender": "both", "mbti": ["INTJ", "ENTP", "INFJ", "ENFP", "INTP"], "genres": ["판타지", "액션"]},
        {"id": 2, "title": "대부", "age": [30, 60], "gender": "male", "mbti": ["INTJ", "ENTJ", "ISTJ", "ESTJ"], "genres": ["범죄", "드라마"]},
        {"id": 3, "title": "기생충", "age": [20, 50], "gender": "both", "mbti": ["INTJ", "INTP", "INFJ", "ENTP"], "genres": ["드라마", "스릴러"]},
        {"id": 4, "title": "슈렉", "age": [5, 40], "gender": "both", "mbti": ["ENFP", "ESFP", "ISFP"], "genres": ["애니메이션", "코미디"]},
        {"id": 5, "title": "위플래쉬", "age": [15, 40], "gender": "both", "mbti": ["INTJ", "ENTJ", "ISTP"], "genres": ["음악", "드라마"]},
        {"id": 6, "title": "나이브스 아웃", "age": [15, 50], "gender": "both", "mbti": ["INTP", "ENTP", "INTJ"], "genres": ["미스터리", "추리"]},
        {"id": 7, "title": "센과 치히로의 행방불명", "age": [5, 45], "gender": "both", "mbti": ["INFJ", "INFP", "ISFP"], "genres": ["애니메이션", "판타지"]},
        {"id": 8, "title": "포레스트 검프", "age": [10, 65], "gender": "both", "mbti": ["ISFJ", "INFP", "ESFJ", "INFJ"], "genres": ["드라마", "휴먼"]},
        {"id": 9, "title": "셔터 아일랜드", "age": [20, 50], "gender": "both", "mbti": ["INTJ", "INTP", "INFJ", "ISTP"], "genres": ["스릴러", "미스터리"]},
        {"id": 10, "title": "아가씨", "age": [20, 40], "gender": "female", "mbti": ["INFJ", "INTJ", "ISFP", "ENTP"], "genres": ["로맨스", "드라마"]},
        // ... (나머지 11~99번 데이터 유지)
        {"id": 99, "title": "6시간 후 너는 죽는다", "age": [15, 40], "gender": "both", "mbti": ["INTJ", "INTP", "INFJ", "ISTP", "ENTP"], "genres": ["스릴러", "미스터리"]}
    ];

    // 3. TMDB API에서 포스터 가져오는 함수
    async function getPosterPath(title) {
        const url = `https://api.themoviedb.org/3/search/movie?query=${encodeURIComponent(title)}&language=ko-KR`;
        const options = {
            method: 'GET',
            headers: {
                accept: 'application/json',
                Authorization: `Bearer ${ACCESS_TOKEN}`
            }
        };
        try {
            const response = await fetch(url, options);
            const data = await response.json();
            if (data.results && data.results.length > 0 && data.results[0].poster_path) {
                return IMAGE_BASE_URL + data.results[0].poster_path;
            }
            return 'https://via.placeholder.com/300x450/222/fff?text=No+Image';
        } catch (error) {
            console.error("TMDB 오류:", error);
            return 'https://via.placeholder.com/300x450/222/fff?text=Error';
        }
    }

    // 4. 분석 및 추천 실행 함수
    async function recommend() {
        const grid = document.getElementById('movieGrid');
        grid.innerHTML = '<div class="loading">AI가 실시간 포스터와 데이터를 분석 중입니다...</div>';

        const userAge = parseInt(document.getElementById('age').value) || 25;
        const userGender = document.getElementById('gender').value;
        const userMBTI = document.getElementById('mbti').value;

        const scoredMovies = movies.map(movie => {
            let score = 0;
            if (movie.mbti.includes(userMBTI)) score += 50;

            const [minAge, maxAge] = movie.age;
            const centerAge = (minAge + maxAge) / 2;
            const radius = (maxAge - minAge) / 2 || 1;

            if (userAge >= minAge && userAge <= maxAge) {
                const distance = Math.abs(userAge - centerAge);
                const ageScore = 30 - (distance / radius) * 20; 
                score += ageScore;
            }
            if (movie.gender === "both" || movie.gender === userGender) score += 20;

            return { ...movie, finalScore: Math.round(score) };
        });

        scoredMovies.sort((a, b) => b.finalScore - a.finalScore);
        await render(scoredMovies);
    }

    // 5. 화면에 카드 렌더링
    async function render(list) {
        const grid = document.getElementById('movieGrid');
        grid.innerHTML = '';
        const movieCards = await Promise.all(list.map(async (movie) => {
            const posterUrl = await getPosterPath(movie.title);
            return `
                <div class="movie-card">
                    <div class="match-score">${movie.finalScore}% Match</div>
                    <img class="poster" src="${posterUrl}" alt="${movie.title}" loading="lazy">
                    <div class="movie-info">
                        <h3>${movie.title}</h3>
                        <div class="tags">
                            ${movie.genres.map(g => `<span class="tag">${g}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        }));
        grid.innerHTML = movieCards.join('');
    }

    recommend();
</script>
</body>
</html>
